<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>find_m_logrank — find_m_logrank • ScuRMST</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="find_m_logrank — find_m_logrank"><meta property="og:description" content="This function performs a grid search to find the critical values (m1, m2) for the log-rank test in a two-stage design.
It makes use of probability Prob(W1/sigma1 &amp;gt; m1 &amp;amp; W2/sigma2 &amp;gt; m2 | H_0) = alpha and
the normality of Z-statistics (Kwak and Jung(2017))
(W/sigma) are estimated by simulation. The z statistics can be obtained using the log_rank_sim function
and accessed via its $z_stats output.
When power is not given, the function finds the critical values (m1, m2) that control the overall type I error
while maximizing the power. When power is given, it searches for valid critical values such that the empirical
power is greater than the specified power. If power is given, int_n and fin_n are required
for the expected sample size calculation."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ScuRMST</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/introduction.html">Introduction of ScuRMST</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>find_m_logrank</h1>

    <div class="hidden name"><code>find_m_logrank.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function performs a grid search to find the critical values (m1, m2) for the log-rank test in a two-stage design.
It makes use of probability <code>Prob(W1/sigma1 &gt; m1 &amp; W2/sigma2 &gt; m2 | H_0) = alpha</code> and
the normality of Z-statistics (Kwak and Jung(2017))
(W/sigma) are estimated by simulation. The z statistics can be obtained using the <code>log_rank_sim</code> function
and accessed via its <code>$z_stats</code> output.
When <code>power</code> is not given, the function finds the critical values (m1, m2) that control the overall type I error
while maximizing the power. When <code>power</code> is given, it searches for valid critical values such that the empirical
power is greater than the specified <code>power</code>. If <code>power</code> is given, <code>int_n</code> and <code>fin_n</code> are required
for the expected sample size calculation.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">find_m_logrank</span><span class="op">(</span></span>
<span>  <span class="va">logrank_data</span>,</span>
<span>  <span class="va">corr_h0</span>,</span>
<span>  <span class="va">search_times</span>,</span>
<span>  int_n <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  fin_n <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">alpha</span>,</span>
<span>  <span class="va">sim_size</span>,</span>
<span>  power <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-logrank-data">logrank_data<a class="anchor" aria-label="anchor" href="#arg-logrank-data"></a></dt>
<dd><p>A matrix of log-rank test z statistics for each simulation.</p></dd>


<dt id="arg-corr-h-">corr_h0<a class="anchor" aria-label="anchor" href="#arg-corr-h-"></a></dt>
<dd><p>A numeric value representing the correlation of two stages, calculated as <code>sqrt(var(W1) / var(W))</code>.</p></dd>


<dt id="arg-search-times">search_times<a class="anchor" aria-label="anchor" href="#arg-search-times"></a></dt>
<dd><p>An integer specifying the number of grid search iterations.</p></dd>


<dt id="arg-int-n">int_n<a class="anchor" aria-label="anchor" href="#arg-int-n"></a></dt>
<dd><p>An optional integer specifying the interim sample size (required if <code>power</code> is given).</p></dd>


<dt id="arg-fin-n">fin_n<a class="anchor" aria-label="anchor" href="#arg-fin-n"></a></dt>
<dd><p>An optional integer specifying the total sample size in both arms (required if <code>power</code> is given).</p></dd>


<dt id="arg-alpha">alpha<a class="anchor" aria-label="anchor" href="#arg-alpha"></a></dt>
<dd><p>A numeric value specifying the significance level for hypothesis testing.</p></dd>


<dt id="arg-sim-size">sim_size<a class="anchor" aria-label="anchor" href="#arg-sim-size"></a></dt>
<dd><p>An integer specifying the number of simulations to perform, say 10000.</p></dd>


<dt id="arg-power">power<a class="anchor" aria-label="anchor" href="#arg-power"></a></dt>
<dd><p>An optional numeric value specifying the desired power for the test.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A data frame with the following columns:</p><dl><dt>m1</dt>
<dd><p>Critical value for the first stage test.</p></dd>

<dt>m2</dt>
<dd><p>Critical value for the second stage test.</p></dd>

<dt>PET0</dt>
<dd><p>Probability of early termination under H0.</p></dd>

<dt>PET1</dt>
<dd><p>Probability of early termination under H1.</p></dd>

<dt>alpha</dt>
<dd><p>Empirical overall type I error rate.</p></dd>

<dt>power</dt>
<dd><p>Empirical power of the test.</p></dd>

<dt>PET</dt>
<dd><p>Probability of early termination.</p></dd>

<dt>EN0</dt>
<dd><p>Expected sample size under H0.</p></dd>

<dt>EN1</dt>
<dd><p>Expected sample size under H1.</p></dd>

<dt>EN</dt>
<dd><p>Overall expected sample size.</p></dd>


</dl><p>If no valid critical values are found, the function returns a data frame with:
<code>m1 = 0, m2 = 0, PET0 = 0, PET1 = 0, alpha = 0, power = 0, PET = 0, EN0 = NA, EN1 = NA, EN = NA</code>.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">sim_size</span> <span class="op">&lt;-</span> <span class="fl">5000</span> </span></span>
<span class="r-in"><span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">100</span></span></span>
<span class="r-in"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fl">60</span></span></span>
<span class="r-in"><span><span class="va">acc_time</span> <span class="op">&lt;-</span> <span class="va">N</span> <span class="op">/</span> <span class="va">r</span></span></span>
<span class="r-in"><span><span class="va">cen_time</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="va">lambda_H1</span> <span class="op">&lt;-</span> <span class="fl">0.9</span></span></span>
<span class="r-in"><span><span class="va">HR</span> <span class="op">&lt;-</span> <span class="fl">1.7</span></span></span>
<span class="r-in"><span><span class="va">lambda_H0</span> <span class="op">&lt;-</span> <span class="fl">0.9</span> <span class="op">*</span> <span class="fl">1.7</span></span></span>
<span class="r-in"><span><span class="va">change_time</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="va">interim</span> <span class="op">&lt;-</span> <span class="fl">0.6</span> <span class="op">*</span> <span class="va">acc_time</span></span></span>
<span class="r-in"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">N</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">0.05</span></span></span>
<span class="r-in"><span><span class="va">tau_f</span> <span class="op">&lt;-</span> <span class="fl">2.5</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">data_C</span> <span class="op">&lt;-</span> <span class="fu"><a href="expo_gen_2stages.html">expo_gen_2stages</a></span><span class="op">(</span>N <span class="op">=</span> <span class="va">n</span> <span class="op">*</span> <span class="va">sim_size</span>, acc_time <span class="op">=</span> <span class="va">acc_time</span>, </span></span>
<span class="r-in"><span>                       lambda <span class="op">=</span> <span class="va">lambda_H0</span>, dist <span class="op">=</span> <span class="st">'exp'</span>, </span></span>
<span class="r-in"><span>                       cen_time <span class="op">=</span> <span class="va">cen_time</span>,arm <span class="op">=</span> <span class="fl">0</span>, interim <span class="op">=</span> <span class="va">interim</span><span class="op">)</span>    </span></span>
<span class="r-in"><span><span class="va">data_E_H0</span> <span class="op">&lt;-</span> <span class="fu"><a href="expo_gen_2stages.html">expo_gen_2stages</a></span><span class="op">(</span>N <span class="op">=</span> <span class="va">n</span> <span class="op">*</span> <span class="va">sim_size</span>, acc_time <span class="op">=</span> <span class="va">acc_time</span>, </span></span>
<span class="r-in"><span>                       lambda <span class="op">=</span> <span class="va">lambda_H0</span>, dist <span class="op">=</span> <span class="st">'exp'</span>, </span></span>
<span class="r-in"><span>                       cen_time <span class="op">=</span> <span class="va">cen_time</span>,arm <span class="op">=</span> <span class="fl">1</span>, interim <span class="op">=</span> <span class="va">interim</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">data_E_H1</span> <span class="op">&lt;-</span> <span class="fu"><a href="expo_gen_2stages.html">expo_gen_2stages</a></span><span class="op">(</span>N <span class="op">=</span> <span class="va">n</span> <span class="op">*</span> <span class="va">sim_size</span>, acc_time <span class="op">=</span> <span class="va">acc_time</span>, </span></span>
<span class="r-in"><span>                       lambda <span class="op">=</span> <span class="va">lambda_H1</span>, dist <span class="op">=</span> <span class="st">'exp'</span>, </span></span>
<span class="r-in"><span>                       cen_time <span class="op">=</span> <span class="va">cen_time</span>,arm <span class="op">=</span> <span class="fl">1</span>, interim <span class="op">=</span> <span class="va">interim</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">lr_h0_int</span> <span class="op">&lt;-</span> <span class="fu"><a href="log_rank_sim.html">log_rank_sim</a></span><span class="op">(</span>data_C <span class="op">=</span> <span class="va">data_C</span><span class="op">[</span> , <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span><span class="op">]</span>, data_E <span class="op">=</span> <span class="va">data_E_H0</span><span class="op">[</span> , <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span><span class="op">]</span>, </span></span>
<span class="r-in"><span>                        sim_size <span class="op">=</span>  <span class="va">sim_size</span>, n <span class="op">=</span> <span class="va">n</span>, alpha <span class="op">=</span> <span class="va">alpha</span>, sided <span class="op">=</span> <span class="st">'greater'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">lr_h1_int</span> <span class="op">&lt;-</span> <span class="fu"><a href="log_rank_sim.html">log_rank_sim</a></span><span class="op">(</span>data_C <span class="op">=</span> <span class="va">data_C</span><span class="op">[</span> , <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span><span class="op">]</span>, data_E <span class="op">=</span> <span class="va">data_E_H1</span><span class="op">[</span> , <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span><span class="op">]</span>, </span></span>
<span class="r-in"><span>                        sim_size <span class="op">=</span>  <span class="va">sim_size</span>, n <span class="op">=</span> <span class="va">n</span>, alpha <span class="op">=</span> <span class="va">alpha</span>, sided <span class="op">=</span> <span class="st">'greater'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">lr_h0_fin</span> <span class="op">&lt;-</span> <span class="fu"><a href="log_rank_sim.html">log_rank_sim</a></span><span class="op">(</span>data_C <span class="op">=</span> <span class="va">data_C</span><span class="op">[</span> , <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">1</span><span class="op">)</span><span class="op">]</span>, data_E <span class="op">=</span> <span class="va">data_E_H0</span><span class="op">[</span> , <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">1</span><span class="op">)</span><span class="op">]</span>, </span></span>
<span class="r-in"><span>                        sim_size <span class="op">=</span>  <span class="va">sim_size</span>, n <span class="op">=</span> <span class="va">n</span>, alpha <span class="op">=</span> <span class="va">alpha</span>, sided <span class="op">=</span> <span class="st">'greater'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">lr_h1_fin</span> <span class="op">&lt;-</span> <span class="fu"><a href="log_rank_sim.html">log_rank_sim</a></span><span class="op">(</span>data_C <span class="op">=</span> <span class="va">data_C</span><span class="op">[</span> , <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">1</span><span class="op">)</span><span class="op">]</span>, data_E <span class="op">=</span> <span class="va">data_E_H1</span><span class="op">[</span> , <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">1</span><span class="op">)</span><span class="op">]</span>, </span></span>
<span class="r-in"><span>                        sim_size <span class="op">=</span>  <span class="va">sim_size</span>, n <span class="op">=</span> <span class="va">n</span>, alpha <span class="op">=</span> <span class="va">alpha</span>, sided <span class="op">=</span> <span class="st">'greater'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Get W/sigma</span></span></span>
<span class="r-in"><span><span class="va">z_stats_h1_int</span> <span class="op">&lt;-</span> <span class="va">lr_h1_int</span><span class="op">$</span><span class="va">z_stats</span></span></span>
<span class="r-in"><span><span class="va">z_stats_h1_fin</span> <span class="op">&lt;-</span> <span class="va">lr_h1_fin</span><span class="op">$</span><span class="va">z_stats</span></span></span>
<span class="r-in"><span><span class="va">z_stats_h0_int</span> <span class="op">&lt;-</span> <span class="va">lr_h0_int</span><span class="op">$</span><span class="va">z_stats</span></span></span>
<span class="r-in"><span><span class="va">z_stats_h0_fin</span> <span class="op">&lt;-</span> <span class="va">lr_h0_fin</span><span class="op">$</span><span class="va">z_stats</span></span></span>
<span class="r-in"><span><span class="va">logrank_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">z_stats_h0_int</span>, <span class="va">z_stats_h1_int</span>, <span class="va">z_stats_h0_fin</span>, <span class="va">z_stats_h1_fin</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="va">corr_h0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">lr_h0_int</span><span class="op">$</span><span class="va">var_w</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">lr_h0_fin</span><span class="op">$</span><span class="va">var_w</span><span class="op">)</span><span class="op">)</span> </span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">best_lr</span> <span class="op">&lt;-</span> <span class="fu">find_m_logrank</span><span class="op">(</span>logrank_data <span class="op">=</span> <span class="va">logrank_data</span>, search_times <span class="op">=</span> <span class="fl">200</span>, corr_h0 <span class="op">=</span> <span class="va">corr_h0</span>,</span></span>
<span class="r-in"><span>                           alpha <span class="op">=</span> <span class="fl">0.05</span>, sim_size <span class="op">=</span> <span class="va">sim_size</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Jiashan He.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>

