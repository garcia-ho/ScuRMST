<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Find the critical value of two-stage log-rank test — find_m_logrank • ScuRMST</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Find the critical value of two-stage log-rank test — find_m_logrank"><meta name="description" content="This function performs a grid search to find the critical values m1, m2) for the log-rank test in a two-stage design.
It makes use of probability Prob(W1 / sigma1 &amp;gt; m1 &amp;amp; W2 / sigma2 &amp;gt; m2 | H0) = alpha and
the normality of Z-statistics (Kwak and Jung(2017))
W / sigma are estimated by simulation. The z-statistics can be obtained using the log_rank_sim function
and accessed via its $z_stats output.
When power is not given, the function finds the critical values (m1, m2) that control the overall type I error
while maximizing the power. When power is given, it searches for valid critical values such that the empirical
power is greater than the specified power. If power is given, int_n and fin_n are required
for the expected sample size calculation."><meta property="og:description" content="This function performs a grid search to find the critical values m1, m2) for the log-rank test in a two-stage design.
It makes use of probability Prob(W1 / sigma1 &amp;gt; m1 &amp;amp; W2 / sigma2 &amp;gt; m2 | H0) = alpha and
the normality of Z-statistics (Kwak and Jung(2017))
W / sigma are estimated by simulation. The z-statistics can be obtained using the log_rank_sim function
and accessed via its $z_stats output.
When power is not given, the function finds the critical values (m1, m2) that control the overall type I error
while maximizing the power. When power is given, it searches for valid critical values such that the empirical
power is greater than the specified power. If power is given, int_n and fin_n are required
for the expected sample size calculation."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ScuRMST</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html">Home</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/garcia-ho/RMST_Code">Github</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Find the critical value of two-stage log-rank test</h1>

      <div class="d-none name"><code>find_m_logrank.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function performs a grid search to find the critical values m1, m2) for the log-rank test in a two-stage design.
It makes use of probability Prob(W1 / sigma1 &gt; m1 &amp; W2 / sigma2 &gt; m2 | H0) = alpha and
the normality of Z-statistics (Kwak and Jung(2017))
W / sigma are estimated by simulation. The z-statistics can be obtained using the <code>log_rank_sim</code> function
and accessed via its <code>$z_stats</code> output.
When <code>power</code> is not given, the function finds the critical values (m1, m2) that control the overall type I error
while maximizing the power. When <code>power</code> is given, it searches for valid critical values such that the empirical
power is greater than the specified <code>power</code>. If <code>power</code> is given, <code>int_n</code> and <code>fin_n</code> are required
for the expected sample size calculation.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">find_m_logrank</span><span class="op">(</span></span>
<span>  <span class="va">logrank_data</span>,</span>
<span>  <span class="va">corr_h0</span>,</span>
<span>  <span class="va">search_times</span>,</span>
<span>  int_n <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  fin_n <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">alpha</span>,</span>
<span>  <span class="va">sim_size</span>,</span>
<span>  power <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-logrank-data">logrank_data<a class="anchor" aria-label="anchor" href="#arg-logrank-data"></a></dt>
<dd><p>A matrix of log-rank test z statistics for each simulation.</p></dd>


<dt id="arg-corr-h-">corr_h0<a class="anchor" aria-label="anchor" href="#arg-corr-h-"></a></dt>
<dd><p>A numeric value representing the correlation of two stages, calculated as <code>sqrt(var(W1) / var(W))</code>.</p></dd>


<dt id="arg-search-times">search_times<a class="anchor" aria-label="anchor" href="#arg-search-times"></a></dt>
<dd><p>An integer specifying the number of grid search iterations.</p></dd>


<dt id="arg-int-n">int_n<a class="anchor" aria-label="anchor" href="#arg-int-n"></a></dt>
<dd><p>An optional integer specifying the interim sample size (required if <code>power</code> is given).</p></dd>


<dt id="arg-fin-n">fin_n<a class="anchor" aria-label="anchor" href="#arg-fin-n"></a></dt>
<dd><p>An optional integer specifying the total sample size in both arms (required if <code>power</code> is given).</p></dd>


<dt id="arg-alpha">alpha<a class="anchor" aria-label="anchor" href="#arg-alpha"></a></dt>
<dd><p>A numeric value specifying the significance level for hypothesis testing.</p></dd>


<dt id="arg-sim-size">sim_size<a class="anchor" aria-label="anchor" href="#arg-sim-size"></a></dt>
<dd><p>An integer specifying the number of simulations to perform, say 10000.</p></dd>


<dt id="arg-power">power<a class="anchor" aria-label="anchor" href="#arg-power"></a></dt>
<dd><p>An optional numeric value specifying the desired power for the test.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A data frame with the following columns:</p><dl><dt>m1</dt>
<dd><p>Critical value for the first stage test.</p></dd>

<dt>m2</dt>
<dd><p>Critical value for the second stage test.</p></dd>

<dt>PET0</dt>
<dd><p>Probability of early termination under H0.</p></dd>

<dt>PET1</dt>
<dd><p>Probability of early termination under H1.</p></dd>

<dt>alpha</dt>
<dd><p>Empirical overall type I error rate.</p></dd>

<dt>power</dt>
<dd><p>Empirical power of the test.</p></dd>

<dt>PET</dt>
<dd><p>Probability of early termination.</p></dd>

<dt>EN0</dt>
<dd><p>Expected sample size under H0.</p></dd>

<dt>EN1</dt>
<dd><p>Expected sample size under H1.</p></dd>

<dt>EN</dt>
<dd><p>Overall expected sample size.</p></dd>


</dl><p>If no valid critical values are found, the function returns a data frame with:
<code>m1 = 0, m2 = 0, PET0 = 0, PET1 = 0, alpha = 0, power = 0, PET = 0, EN0 = NA, EN1 = NA, EN = NA</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">sim_size</span> <span class="op">&lt;-</span> <span class="fl">5000</span> </span></span>
<span class="r-in"><span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">100</span></span></span>
<span class="r-in"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fl">60</span></span></span>
<span class="r-in"><span><span class="va">acc_time</span> <span class="op">&lt;-</span> <span class="va">N</span> <span class="op">/</span> <span class="va">r</span></span></span>
<span class="r-in"><span><span class="va">cen_time</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="va">lambda_H1</span> <span class="op">&lt;-</span> <span class="fl">0.9</span></span></span>
<span class="r-in"><span><span class="va">HR</span> <span class="op">&lt;-</span> <span class="fl">1.7</span></span></span>
<span class="r-in"><span><span class="va">lambda_H0</span> <span class="op">&lt;-</span> <span class="fl">0.9</span> <span class="op">*</span> <span class="fl">1.7</span></span></span>
<span class="r-in"><span><span class="va">change_time</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="va">interim</span> <span class="op">&lt;-</span> <span class="fl">0.6</span> <span class="op">*</span> <span class="va">acc_time</span></span></span>
<span class="r-in"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">N</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">0.05</span></span></span>
<span class="r-in"><span><span class="va">tau_f</span> <span class="op">&lt;-</span> <span class="fl">2.5</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">data_C</span> <span class="op">&lt;-</span> <span class="fu"><a href="expo_gen_2stages.html">expo_gen_2stages</a></span><span class="op">(</span>N <span class="op">=</span> <span class="va">n</span> <span class="op">*</span> <span class="va">sim_size</span>, acc_time <span class="op">=</span> <span class="va">acc_time</span>, </span></span>
<span class="r-in"><span>                       lambda <span class="op">=</span> <span class="va">lambda_H0</span>, dist <span class="op">=</span> <span class="st">'exp'</span>, </span></span>
<span class="r-in"><span>                       cen_time <span class="op">=</span> <span class="va">cen_time</span>,arm <span class="op">=</span> <span class="fl">0</span>, interim <span class="op">=</span> <span class="va">interim</span><span class="op">)</span>    </span></span>
<span class="r-in"><span><span class="va">data_E_H0</span> <span class="op">&lt;-</span> <span class="fu"><a href="expo_gen_2stages.html">expo_gen_2stages</a></span><span class="op">(</span>N <span class="op">=</span> <span class="va">n</span> <span class="op">*</span> <span class="va">sim_size</span>, acc_time <span class="op">=</span> <span class="va">acc_time</span>, </span></span>
<span class="r-in"><span>                       lambda <span class="op">=</span> <span class="va">lambda_H0</span>, dist <span class="op">=</span> <span class="st">'exp'</span>, </span></span>
<span class="r-in"><span>                       cen_time <span class="op">=</span> <span class="va">cen_time</span>,arm <span class="op">=</span> <span class="fl">1</span>, interim <span class="op">=</span> <span class="va">interim</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">data_E_H1</span> <span class="op">&lt;-</span> <span class="fu"><a href="expo_gen_2stages.html">expo_gen_2stages</a></span><span class="op">(</span>N <span class="op">=</span> <span class="va">n</span> <span class="op">*</span> <span class="va">sim_size</span>, acc_time <span class="op">=</span> <span class="va">acc_time</span>, </span></span>
<span class="r-in"><span>                       lambda <span class="op">=</span> <span class="va">lambda_H1</span>, dist <span class="op">=</span> <span class="st">'exp'</span>, </span></span>
<span class="r-in"><span>                       cen_time <span class="op">=</span> <span class="va">cen_time</span>,arm <span class="op">=</span> <span class="fl">1</span>, interim <span class="op">=</span> <span class="va">interim</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">lr_h0_int</span> <span class="op">&lt;-</span> <span class="fu"><a href="log_rank_sim.html">log_rank_sim</a></span><span class="op">(</span>data_C <span class="op">=</span> <span class="va">data_C</span><span class="op">[</span> , <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span><span class="op">]</span>, data_E <span class="op">=</span> <span class="va">data_E_H0</span><span class="op">[</span> , <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span><span class="op">]</span>, </span></span>
<span class="r-in"><span>                        sim_size <span class="op">=</span>  <span class="va">sim_size</span>, n <span class="op">=</span> <span class="va">n</span>, alpha <span class="op">=</span> <span class="va">alpha</span>, sided <span class="op">=</span> <span class="st">'greater'</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in makeCluster(n_cores):</span> could not find function "makeCluster"</span>
<span class="r-in"><span><span class="va">lr_h1_int</span> <span class="op">&lt;-</span> <span class="fu"><a href="log_rank_sim.html">log_rank_sim</a></span><span class="op">(</span>data_C <span class="op">=</span> <span class="va">data_C</span><span class="op">[</span> , <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span><span class="op">]</span>, data_E <span class="op">=</span> <span class="va">data_E_H1</span><span class="op">[</span> , <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span><span class="op">]</span>, </span></span>
<span class="r-in"><span>                        sim_size <span class="op">=</span>  <span class="va">sim_size</span>, n <span class="op">=</span> <span class="va">n</span>, alpha <span class="op">=</span> <span class="va">alpha</span>, sided <span class="op">=</span> <span class="st">'greater'</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in makeCluster(n_cores):</span> could not find function "makeCluster"</span>
<span class="r-in"><span><span class="va">lr_h0_fin</span> <span class="op">&lt;-</span> <span class="fu"><a href="log_rank_sim.html">log_rank_sim</a></span><span class="op">(</span>data_C <span class="op">=</span> <span class="va">data_C</span><span class="op">[</span> , <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">1</span><span class="op">)</span><span class="op">]</span>, data_E <span class="op">=</span> <span class="va">data_E_H0</span><span class="op">[</span> , <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">1</span><span class="op">)</span><span class="op">]</span>, </span></span>
<span class="r-in"><span>                        sim_size <span class="op">=</span>  <span class="va">sim_size</span>, n <span class="op">=</span> <span class="va">n</span>, alpha <span class="op">=</span> <span class="va">alpha</span>, sided <span class="op">=</span> <span class="st">'greater'</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in makeCluster(n_cores):</span> could not find function "makeCluster"</span>
<span class="r-in"><span><span class="va">lr_h1_fin</span> <span class="op">&lt;-</span> <span class="fu"><a href="log_rank_sim.html">log_rank_sim</a></span><span class="op">(</span>data_C <span class="op">=</span> <span class="va">data_C</span><span class="op">[</span> , <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">1</span><span class="op">)</span><span class="op">]</span>, data_E <span class="op">=</span> <span class="va">data_E_H1</span><span class="op">[</span> , <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">1</span><span class="op">)</span><span class="op">]</span>, </span></span>
<span class="r-in"><span>                        sim_size <span class="op">=</span>  <span class="va">sim_size</span>, n <span class="op">=</span> <span class="va">n</span>, alpha <span class="op">=</span> <span class="va">alpha</span>, sided <span class="op">=</span> <span class="st">'greater'</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in makeCluster(n_cores):</span> could not find function "makeCluster"</span>
<span class="r-in"><span><span class="co"># Get W/sigma</span></span></span>
<span class="r-in"><span><span class="va">z_stats_h1_int</span> <span class="op">&lt;-</span> <span class="va">lr_h1_int</span><span class="op">$</span><span class="va">z_stats</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'lr_h1_int' not found</span>
<span class="r-in"><span><span class="va">z_stats_h1_fin</span> <span class="op">&lt;-</span> <span class="va">lr_h1_fin</span><span class="op">$</span><span class="va">z_stats</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'lr_h1_fin' not found</span>
<span class="r-in"><span><span class="va">z_stats_h0_int</span> <span class="op">&lt;-</span> <span class="va">lr_h0_int</span><span class="op">$</span><span class="va">z_stats</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'lr_h0_int' not found</span>
<span class="r-in"><span><span class="va">z_stats_h0_fin</span> <span class="op">&lt;-</span> <span class="va">lr_h0_fin</span><span class="op">$</span><span class="va">z_stats</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'lr_h0_fin' not found</span>
<span class="r-in"><span><span class="va">logrank_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">z_stats_h0_int</span>, <span class="va">z_stats_h1_int</span>, <span class="va">z_stats_h0_fin</span>, <span class="va">z_stats_h1_fin</span><span class="op">)</span> </span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'z_stats_h0_int' not found</span>
<span class="r-in"><span><span class="va">corr_h0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">lr_h0_int</span><span class="op">$</span><span class="va">var_w</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">lr_h0_fin</span><span class="op">$</span><span class="va">var_w</span><span class="op">)</span><span class="op">)</span> </span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'lr_h0_int' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">best_lr</span> <span class="op">&lt;-</span> <span class="fu">find_m_logrank</span><span class="op">(</span>logrank_data <span class="op">=</span> <span class="va">logrank_data</span>, search_times <span class="op">=</span> <span class="fl">200</span>, corr_h0 <span class="op">=</span> <span class="va">corr_h0</span>,</span></span>
<span class="r-in"><span>                           alpha <span class="op">=</span> <span class="fl">0.05</span>, sim_size <span class="op">=</span> <span class="va">sim_size</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'logrank_data' not found</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jiashan He.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

